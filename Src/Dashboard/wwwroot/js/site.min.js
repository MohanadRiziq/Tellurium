var baseReplaceWith=$.fn.replaceWith,baseReplaceHtml;$.fn.replaceWith=function(){var n,t;return typeof arguments[0]=="string"&&(n=arguments[0]=$(arguments[0])),t=baseReplaceWith.apply(this,arguments),n!=null&&$.ui.modernUnobtrusive.parse(n),t};baseReplaceHtml=$.fn.html;$.fn.html=function(){var n,t;return typeof arguments[0]=="string"&&(n=arguments[0]=$(arguments[0])),t=baseReplaceHtml.apply(this,arguments),n!=null&&$.ui.modernUnobtrusive.parse(n),t};$.postJSON=function(n,t,i){var r={contentType:"application/json; charset=utf-8",type:"POST",url:n,data:JSON.stringify(t)};return $.extend(r,i),$.ajax(r)},function(n){"use strict";function t(t,i){var r={},u=("data-ui-"+t+"-").toLowerCase();return Array.prototype.forEach.call(i.attributes,function(t){if(t.specified!=!1&&t.name.indexOf(u)===0){var f=n.camelCase(t.name.substr(u.length)),e=t.name.substr(5);r[f]=n(i).data(e)}}),r}n.ui.modernUnobtrusive={parse:function(t){n("[data-ui-fn]",t).each(function(){n.ui.modernUnobtrusive.parseElement(this)});n(t).is("[data-ui-fn]")&&n.ui.modernUnobtrusive.parseElement(n(t))},parseElement:function(i){var r=n(i),u=r[0],f=r.attr("data-ui-fn").split(" ");f.forEach(function(n){var i=r[n],f;i&&(r.data(n)!==undefined&&i.call(r,"destroy"),f=t(n,u),i.call(r,f))})}};n(function(){n.ui.modernUnobtrusive.parse(window.document)})}(window.jQuery);$.widget("ui.remoteexpander",{version:"1.0.0",_create:function(){var i=this,r=!1,n=$("#"+this.options.targetid),t=!1;this.element.on("click",function(){if(!t)if(r==!1){t=!0;var u=$("<span><\/span>",{"class":"glyphicon glyphicon-refresh glyphicon-refresh-animate"});i.element.append(u);n.load(i.options.source,function(){function e(){r=!0;n.removeClass("collapse");u.remove();t=!1}function o(){i--;i==0&&e()}var f=n.find("img"),i=f.length;if(i==0)e();else f.on("load",o).on("error",o)})}else n.toggleClass("collapse")})}});$.widget("ui.testcase",{version:"1.0.0",_create:function(){function e(n){return parseFloat(n.replace("%",""))}function s(i,r){var u=t._getScreenshotDimensions(),f=$("<div><\/div>",{"class":"blind "+r,tabindex:o++});n.append(f);f.css({left:i.Left/u.width*100+"%",top:i.Top/u.height*100+"%",width:i.Width/u.width*100+"%",height:i.Height/u.height*100+"%"})}function c(t){var i=n.offset();return{x:t.pageX-i.left,y:t.pageY-i.top}}var f=!1,r,l=this.element.find(".label"),t=this,i,u=!1,h="local",n,o;this.element.find("[data-testcase-element='scope']").on("click",".btn",function(){$(this).siblings().removeClass("active");$(this).addClass("active");h=$(this).data("testcase-element")});n=this.element.find("[data-testcase-element='board']");this.element.on("click","[data-testcase-element='save']",function(i){if(i.preventDefault(),!u){var f=n.width(),o=n.height(),s=[],h=[],c=[],r=t._getScreenshotDimensions();n.find(".blind").each(function(){var n=$(this),t={left:e(n.css("left"))/f*r.width,top:e(n.css("top"))/o*r.height,width:e(n.css("width"))/f*r.width,height:e(n.css("height"))/o*r.height};n.is(".local")?s.push(t):n.is(".category")?h.push(t):c.push(t)});u=!0;$(this).is(".local")?$.postJSON(t.options.actionSaveLocal,{BrowserPatternId:t.options.id,TestCaseId:t.options.caseId,LocalBlindRegions:s}).done(function(){u=!1}):$(this).is(".category")?$.postJSON(t.options.actionSaveCategory,{BlindRegions:h,BrowserName:t.options.browser,TestCaseId:t.options.caseId}).done(function(){u=!1}):$.postJSON(t.options.actionSaveGlobal,{BlindRegions:c,BrowserName:t.options.browser,TestCaseId:t.options.caseId}).done(function(){u=!1})}});n.on("keyup",".blind",function(t){t.keyCode==46&&n.find(".blind.active").remove()});n.on("focus",".blind",function(){$(this).addClass("active")});n.on("blur",".blind.active",function(){$(this).removeClass("active")});n.on("mousedown",".blind",function(n){n.stopPropagation()});o=1;this.element.find(".screenshot").on("load",function(){t.options.localRegions.forEach(function(n){s(n,"local")});t.options.categoryRegions.forEach(function(n){s(n,"category")});t.options.globalRegions.forEach(function(n){s(n,"global")})});n.on("mousedown",function(t){f=!0;r=c(t);i=$("<div><\/div>",{"class":"blind "+h,tabindex:o++});n.append(i)});n.on("mouseup",function(){f&&(f=!1,(i.width()<5||i.height()<5)&&i.remove(),i.focus(),i=null)});n.on("mousemove",function(t){var u=c(t),e,o;l.text("X:"+u.x+" Y:"+u.y);f&&(e=n.width(),o=n.height(),i.css({left:Math.min(r.x,u.x)/e*100+"%",top:Math.min(r.y,u.y)/o*100+"%",width:Math.abs(u.x-r.x)/e*100+"%",height:Math.abs(u.y-r.y)/o*100+"%"}))})},_getScreenshotDimensions:function(){var n=this.element.find(".screenshot").get(0);return{width:n.naturalWidth,height:n.naturalHeight}}});